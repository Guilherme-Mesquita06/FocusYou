<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../css/addSerie.css" />
    <link rel="stylesheet" href="../css/nav.css" />
    <title>Document</title>
</head>

<body onload="exibirTreinos(idUsuario)">
    <div class="header">
        <div class="container">
            <div class="logoTitulo">
                <img src="../assets/icon/LogoFocus.svg" width="90vw" alt="" />
                  <p class="navTitulo">Aretê</p>
            </div>

            <nav class="navbar">
                <div class="links">
                    <div style="background-color: brown;">
                        <a href="">Treinar</a>
                    </div>
                    <div>
                        <a href="./addTreino.html">Nova Ficha</a>
                    </div>
                    <div>
                        <a href="./dashboard1.html">Dashboard</a>
                    </div>
                    <div>
                        <a href="./historicoFicha.html">Historico</a>
                    </div>
                </div>
            </nav>
        </div>
    </div>

    <main>
        <div id="boasVindas" style="margin-left: 3%; margin-top: 3%;"></div>
        <div id="titulo">

        </div>
        <section class="content">

            <div class="containerTreino">
                <section class="treinos secDiv">
                    <h2>Treinos da ficha ativa</h2>
                    <div id="linhaTreinos"> </div>
                </section>



            </div>


            <section id="exercicios" style="display: none;">
                <h2>Exercícios</h2>
                <div class="exerciciosSeries">
                    <div id="listaExerciciosTreino"></div>
                    <div id="serie" style="display: none;"></div>


                </div>
            </section>
        </section>

    </main>
</body>

<script>
    var treino = 0


    let idTreino;

    const idUsuario = sessionStorage.ID_USUARIO;

    //  JSON.parse(sessionStorage.AQUARIOS) vai no lucar do treinos 
    function exibirTreinos(idUsuario) {
        const nomeUsuario = sessionStorage.NOME_USUARIO;
        const divBoasVindas = document.getElementById("boasVindas");

        divBoasVindas.innerHTML = `
    Olá, <span>${nomeUsuario}</span> vamos treinar?
`;


        console.log(idUsuario)

        fetch(`/treinos/buscar/ativo/${idUsuario}`)
            .then(resposta => resposta.json())
            .then(treinos => {



                console.table(treinos)



                treinos.forEach(treino => {

                    document.getElementById("titulo").innerHTML = `
                <p>${treino.tituloFicha}</p>
                
                `;

                    document.getElementById("linhaTreinos").innerHTML += `
                   <button onclick="exibirExercicios(${treino.idTreino})" id="getTreino">
                <div>${treino.tituloTreino}</div>
                </button>

        `

                });

            })
    }


    function exibirExercicios(idTreino) {

        document.getElementById("exercicios").style.width = '40%';
        document.getElementById("listaExerciciosTreino").style.width = '98%';
        document.getElementById("serie").style.display = 'none';

        fetch(`/exercicios/buscar/${idTreino}`)
            .then(resposta => resposta.json())
            .then(exercicios => {

                document.getElementById("exercicios").style.display = 'flex';
                document.getElementById('listaExerciciosTreino').innerHTML = `
                <table id="tabelaEx">
                 <tr>
                    <th>Exercício</th>
                    <th>Agrupamento muscular</th>
                    <th>Equipamento</th>
                    <th>Ação</th>
                </tr>
                   </table>
                `
                document.getElementById("tabelaEx").style.display = 'flex';

                exercicios.forEach(ex => {
                    document.getElementById("tabelaEx").innerHTML += `
                        <tbody>
                            <tr class="linhaEx">
                                <td class="tituloEx">${ex.nomeExercicio}</td>
                                <td class="subInfoEx">${ex.agrupamento}</td>
                                <td class="subInfoEx"> ${ex.equipamento}</td>

                                <td>
                                    <button class="btnFazer" onclick="RealizarSeries(${ex.idExercicio})">
                                        ▶ Realizar série
                                    </button>
                                </td>
                            </tr>
                              <tbody>
                              `;
                });
            });

    }

    function RealizarSeries(idExercicio) {
        /*    Exercicios width: 90%;  */
        /*ListaExercicios 60% */
        document.getElementById("exercicios").style.width = '90%';
        document.getElementById("listaExerciciosTreino").style.width = '93%';
        document.getElementById("serie").style.display = 'flex';

        document.getElementById("serie").innerHTML = `
                <div class="form">
                                <h2> Cadastar serie </h2>

                    <div class="row">
                        <div class="campoSerie">
                            <label for="">Repetições</label>
                            <input type="number" id="iptRepeticoes" placeholder="10">
                        </div>
                        <div class="campoSerie">
                            <label for="">Carga Realizada (em Kg)</label>
                            <input type="number" id="iptCarga" placeholder="30">
                        </div>
                        <div class="campoSerie">
                            <label for="">Tempo De Descanso (Segundos)</label>
                            <input type="time" id="iptTempo" placeholder="1:20 ">
                        </div>
                       
                    </div>
                     <div class="btnFeito">
                            <button onclick="cadastrarSerie(${idExercicio})">cadastrar série</button>
                        </div>
                </div>           

        `;
    }

    function cadastrarSerie(idExercicio) {

        let repeticoesVar = Number(iptRepeticoes.value)
        let tempoVar = iptTempo.value
        let cargaVar = Number(iptCarga.value)

        if (
            iptRepeticoes.value == "" ||
            iptTempo.value == "" ||
            iptCarga.value == ""

        ) {
            console.log('Preencha todos os campos')

        } else {

            fetch(`/series/cadastrar`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    idExercicio: idExercicio,
                    tempoServer: tempoVar,
                    repeticoesServer: repeticoesVar,
                    cargaServer: cargaVar,

                }),

            }).then(resposta => resposta.json())
                .then(serie => {
                    console.log('UUUUIAAAAA', serie)

                    iptRepeticoes.value = ''
                    iptTempo.value = ''
                    iptCarga.value = ''

                }).catch(err => {
                    console.log('Não sou o maioral', err)
                })
        }

    }

</script>

</html>