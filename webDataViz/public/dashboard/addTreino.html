<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/addTreino.css">
    <link rel="stylesheet" href="../css/nav.css">
    <title>Document</title>
</head>

<body onload="listarTreinos(), carregarTreinosSelect(treinos)">

    <div class="header">
        <div class="container">
            <div class="logoTitulo">
                <img src="../assets/icon/LogoFocus.svg" width="90vw" alt="">
                <p class="navTitulo">Aret√™</p>

            </div>

            <nav class="navbar">
                <div class="links">
                    <div>
                        <a href="./addSerie.html">Treinar</a>
                    </div>
                    <div style="background-color: brown;">
                        <a>Nova Ficha</a>
                    </div>
                    <div>
                        <a href="./dashboard1.html">Dashboard</a>
                    </div>
                    <div>
                        <a href="./historicoFicha.html">Historico</a>
                    </div>
                </div>
            </nav>

        </div>
    </div>

    <main>

        <section class="content">

            <!-- FORMUL√ÅRIO FICHA -->
            <div id="secCadastrarTreino">
                <div class="titulo">
                    <p class="secTitulo">Cadastre informa√ß√µes da sua Ficha</p>
                    <p style="color:#fff; margin-left: 5%;">Em caso de recarregar a pagina sua ficha n√£o ser√° perdida!
                        Apenas prossiga no cadastro
                    </p>
                </div>

                <div class="form">

                    <div class="campos">
                        <div class="campo">
                            <label>Titulo</label>
                            <input id="iptTitulo" type="text" placeholder="Foco em ombros">
                        </div>

                        <div class="campo">
                            <label>Data inicio</label>
                            <input id="iptDtInicio" type="date">
                        </div>
                    </div>

                    <div class="campos">
                        <div class="campo">
                            <label>Frequencia Semanal</label>
                            <input id="iptFrequencia" type="text">
                        </div>

                        <div class="campo">
                            <label>Objetivo</label>
                            <form>
                                <p>
                                    <select id="objSelect">
                                        <option value="" selected disabled>Selecione seu objetivo</option>
                                        <option value="forca">üí™üèº For√ßa</option>
                                        <option value="hipertrofia">üèãüèº‚Äç‚ôÇÔ∏è Hipertrofia</option>
                                        <option value="Recuperacao">üöë Reabilita√ß√£o</option>
                                        <option value="Emagrecimento">üèÉüèª Emagrecimento</option>
                                    </select>
                                </p>
                            </form>
                        </div>
                    </div>

                    <div class="observacao">
                        <label>Observa√ß√µes</label>
                        <textarea id="textObservacao"></textarea>
                    </div>

                    <div class="btn">
                        <button onclick="cadastrarFicha()">Cadastrar ficha</button>
                    </div>
                    <div id="msgFicha"></div>


                </div>
            </div>

            <section id="addTreino">
                <div class="contentAddTreino">
                    <div class="tituloTreino">
                        <p>Cadastrar treinos</p>
                    </div>
                    <p style="color:#fff; margin-left: 3%;">Ap√≥s cadastrar a ficha, cadastre os treinos! seprando-os por
                        agrupamento muscular</p>

                    <div class="campos camposTreino">
                        <div class="campo campoTreino">
                            <label>Titulo do treino</label>
                            <input id="iptTreinoTitulo" type="text" placeholder="Costas e biecps">
                        </div>

                        <div class="observacao">
                            <label>Observa√ß√µes</label>
                            <textarea id="observacaoTreino" class="textAreaTreino"></textarea>
                        </div>
                    </div>
                    <div id="alertaTreino1" style="    
    display: none;
    color: #ff3b3b;
    font-weight: 900;
    font-size: 18px;
    margin: 10px 0 20px 10px;">
                        De um titulo ao seu treino.
                    </div>

                    <div class="btnTreino">
                        <button onclick="cadastrarTreino()">Cadastrar Treino</button>
                    </div>
                </div>
            </section>


            <section id="addExercicio">

                <div class="contentAddExercicio">

                    <div class="tituloExercicio">
                        <p>Adicionar Exerc√≠cio</p>
                    </div>
                    <div class="camposExercicio">

                        <div class="campoEx">
                            <label>Treino</label>
                            <select id="selectTreino"></select>
                        </div>

                        <div class="campoEx">
                            <label>Equipamentos</label>

                            <select id="iptEquipEx">
                                <option value="#" disabled selected>Selecione o equipamento a ser utilizado</option>
                                <option value="Halteres">Halteres</option>
                                <option value="Barra"> Barra</option>
                                <option value="Maquina"> M√°quina</option>
                                <option value="Colchonete">Colchonete</option>
                                <option value="Elastico">El√°stico</option>
                                <option value="Rolinho"> Rolinho</option>


                            </select>
                        </div>
                    </div>


                    <div class="camposExercicio">

                        <div class="campoEx">
                            <label>Agrupamento muscular</label>
                            <select id="slctGrupoEx">
                                <option value="" selected disabled>Selecione o agrupamento muscular</option>

                                <option value="Peito">üèãÔ∏è Peito</option>
                                <option value="Costas">üèãÔ∏è‚Äç‚ôÇÔ∏è Costas</option>
                                <option value="Lombar">ü¶¥ Lombar</option>
                                <option value="Trapezio">üí™ Trap√©zio</option>
                                <option value="Biceps">üí™ B√≠ceps</option>
                                <option value="Triceps">üí™ Tr√≠ceps</option>
                                <option value="Ombro">üèãÔ∏è Ombro</option>
                                <option value="Antebra√ßo">‚úã Antebra√ßo</option>
                                <option value="Abdominal">üî• Abdominal</option>
                                <option value="Abdutor">ü¶µ Abdutor</option>
                                <option value="Adutor">ü¶µ Adutor</option>
                                <option value="Quadriceps">ü¶ø Quadr√≠ceps</option>
                                <option value="Posterior">ü¶ø Posterior</option>
                                <option value="Panturrilha">ü¶∂ Panturrilha</option>
                                <option value="Gluteo">üçë Gl√∫teo</option>
                                <option value="Tibia">ü¶µ T√≠bia</option>
                            </select>

                        </div>


                        <div class="campoEx">
                            <label>Observa√ß√£o</label>
                            <input id="iptDescEx" type="text" placeholder="Drop-Set / Rest-Pause ...">
                        </div>
                    </div>

                    <div class="camposExercicio">
                        <div class="campoEx">
                            <label>Nome do exercicio</label>
                            <input id="iptNomeEx" type="text" placeholder="Supino inclinado">
                        </div>


                        <div class="campoEx">
                            <label>Dificuldade</label>
                            <select id="slctDificuldadeEx">
                                <option value="#" disabled selected>Selecione sua dificuldade</option>
                                <option value="Dificil">üî¥ Dif√≠cil</option>
                                <option value="Medio"> üü°Medio</option>
                                <option value="Facil"> üü¢F√°cil</option>


                            </select>
                        </div>


                    </div>

                    <div class="btnAddEx">
                        <button class="btnExercicio" onclick=" listarExercicios(idTreino)">Listar exercicios</button>
                        <button class="btnExercicio"
                            onclick="adicionarExercicio(), listarExercicios(idTreino)">Adicionar exercicio</button>

                    </div>



                    <div id="alertaTreino" style="    
    display: none;
    color: #ff3b3b;
    font-weight: 900;
    font-size: 18px;
    margin: 10px 0 20px 10px;">


                        Selecione um treino para listar os exerc√≠cios j√° cadastrados.
                    </div>
                    <div id="alertaExercicio" style="    
    display: none;
    color: #ff3b3b;
    font-weight: 900;
    font-size: 18px;
    margin: 10px 0 20px 10px;">
                        Preencha os campos para adicionar um exercicio.
                    </div>

                    <div id="divListaExercicios"> </div>


            </section>

        </section>

    </main>


</body>

<script>



    const idFicha = sessionStorage.ID_FICHA;
    let idTreino = 0;


    function cadastrarFicha() {


        var idUsuario = sessionStorage.ID_USUARIO
        var tituloVar = iptTitulo.value
        var dataInicioVar = iptDtInicio.value
        var frequenciaVar = Number(iptFrequencia.value);
        var objetivoVar = objSelect.value;
        const observacaoVar = document.getElementById('textObservacao').value;


        if (
            tituloVar == "" ||
            dataInicioVar == "" ||
            frequenciaVar == "" ||
            objetivoVar == ""
        ) {
            console.log('Preencha todos os campos')
        } else {


            fetch("/fichas/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    idUsuario: idUsuario,
                    tituloVar: tituloVar,
                    dataInicioVar: dataInicioVar,
                    frequenciaVar: frequenciaVar,
                    objetivoVar: objetivoVar,
                    observacaoVar: observacaoVar
                }),

            }).then(resposta => resposta.json())
                .then(ficha => {
                    console.log('Ronaldo:', ficha);
                    sessionStorage.ID_FICHA = ficha.insertId;
                    console.log(sessionStorage.ID_FICHA);


                    iptTitulo.value = ''
                    iptDtInicio.value = ''
                    iptFrequencia.value = ''
                    objSelect.value = ''

                    msgFicha.innerHTML = `<p  style="     
    color: #00FF00;
    font-weight: 900;
    font-size: 18px;
    margin: 10px 0 20px 10px;">Ficha cadastrada com sucesso! </p>`;



                });

        }
    }

    function listarTreinos() {
        const idFicha = sessionStorage.ID_FICHA;

        fetch(`/treinos/listar/${idFicha}`)
            .then(resposta => resposta.json())
            .then(treinos => {
                sessionStorage.TREINOS = JSON.stringify(treinos);
                console.log(treinos)
                carregarTreinosSelect(treinos);
            }).catch(err => {
                console.log(`#ERRO: ${err}`);

            })
    }


    function carregarTreinosSelect(treinos) {

        const select = document.getElementById("selectTreino");
        select.innerHTML = `<option value="0" disabled selected>Selecione um treino</option
            >`;


        treinos.forEach(treino => {
            select.innerHTML += `
            <option  value="${treino.idTreino}">${treino.titulo}</option>`;
        });



    }



    function cadastrarTreino() {

        var tituloTreinoVar = iptTreinoTitulo.value;
        var observacaoTreinoVar = observacaoTreino.value;
        var idFichaVar = sessionStorage.ID_FICHA;

        if (iptTreinoTitulo.value == "") {

        } else {


            fetch("/treinos/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    tituloTreinoVar: tituloTreinoVar,
                    observacaoTreinoVar: observacaoTreinoVar,
                    idFichaVar: idFichaVar
                }),
            }).then(resposta => resposta.json().then(treino => {
                console.log('Treino:', treino);
                listarTreinos();

                iptTreinoTitulo.value = '';
                observacaoTreino.value = '';

            })).catch(err => {
                console.log(`#ERRO: ${err}`);

            })
        }
    }



    function listarExercicios(idTreino) {
        console.log(idTreino)
        idTreino = document.getElementById("selectTreino").value


        if (idTreino == 0) {
            document.getElementById("alertaTreino").style.display = "flex";

        } else {
            document.getElementById("alertaTreino").style.display = "none";
            document.getElementById("alertaTreino1").style.display = "none";
            document.getElementById("alertaExercicio").style.display = "none";




            fetch(`/exercicios/buscar/${idTreino}`).then(resposta => resposta.json())
                .then(exercicios => {
                    console.log('Exercicio: ', exercicios)

                    console.table(exercicios)


                    document.getElementById("divListaExercicios").innerHTML = `
                   <table id="listaExercicios" class="tabelaExercicio" style="width:100%">
                        <tr>
                            <th class="tituloEx">Nome</th>
                            <th class="tituloEx">Agrupamento Muscular</th>
                            <th class="tituloEx">Equipamento</th>
                            <th class="tituloEx">Dificuldade</th>

                        </tr>
                    </table>
            `;

                    exercicios.forEach(ex => {
                        document.getElementById("listaExercicios").innerHTML += `
                        <tr>
                                <td class="subInfoEx">${ex.nomeExercicio}</td>
                                <td class="subInfoEx">${ex.agrupamento}</td>
                                <td class="subInfoEx"> ${ex.equipamento}</td>
                                <td class="subInfoEx"> ${ex.dificuldade}</td>

                        </tr>
            `;



                    }),



                        document.getElementById("iptNomeEx").value = "";
                    document.getElementById("iptDescEx").value = "";
                    document.getElementById("slctGrupoEx").value = "";
                    document.getElementById("iptEquipEx").value = "";
                    document.getElementById("slctDificuldadeEx").value = "";



                    console.log(exercicios)
                }).catch(err => {
                    console.log(`#ERRO: ${err}`);

                })
        }

    }
    // Function de adicionar o exercicio na tabela
    function adicionarExercicio() {

        // IDs CORRETOS
        idTreino = document.getElementById("selectTreino").value
        var nomeExVar = document.getElementById("iptNomeEx").value;
        var descricaoExVar = document.getElementById("iptDescEx").value;
        var grupoExVar = document.getElementById("slctGrupoEx").value;
        var equipExVar = document.getElementById("iptEquipEx").value;
        var dificuldadeExVar = document.getElementById("slctDificuldadeEx").value;





        if (!nomeExVar || !grupoExVar || !equipExVar || !dificuldadeExVar) {
            document.getElementById("alertaExercicio").style.display = "flex";

        } else {
            document.getElementById("alertaTreino").style.display = "none";
            document.getElementById("alertaTreino1").style.display = "none";
            document.getElementById("alertaExercicio").style.display = "none";

            let lista = document.getElementById("listaExercicios");

            fetch("/exercicios/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    idTreinoServer: idTreino,
                    agrupamentoServer: grupoExVar,
                    nomeExercicioServer: nomeExVar,
                    equipamentoServer: equipExVar,
                    descricaoServer: descricaoExVar,
                    dificuldadeServer: dificuldadeExVar

                }),

            }).then(resposta => resposta.json().then(exercicio => {
                console.log('Exercicio:', exercicio)
                listarExercicios(idTreino)
            })).catch(err => {
                console.log(`#ERRO: ${err}`);

            })
        }
    }






</script>

</html>