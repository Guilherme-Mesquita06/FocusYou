<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="../css/dashboard.css" />
    <link rel="stylesheet" href="../css/nav.css" />
    <title>FocusYou Dashboard</title>
</head>

<body onload="fichaAtiva(idUsuario),
              chartData(idFicha) , 
              cargaLevantada(idFicha), 
              seriesMes(idFicha),
              frequenciaMes(idFicha),
              frequenciaSemana(idFicha),
              variacaoCarga(idFicha)">
    <div class="header">
        <div class="container">
            <div class="logoTitulo">
                <img src="../assets/icon/LogoFocus.svg" width="90vw" alt="" />
                <p class="navTitulo">Aretê</p>

            </div>

            <nav class="navbar">
                <div class="links">
                    <div>
                        <a href="./addSerie.html">Treinar</a>
                    </div>
                    <div>
                        <a href="./addTreino.html">Nova Ficha</a>
                    </div>
                    <div style="background-color: brown;">
                        <a href="#">Dashboard</a>
                    </div>
                    <div>
                        <a href="./historicoFicha.html">Historico</a>
                    </div>
                </div>
            </nav>
        </div>
    </div>
            <div id="tituloFicha"></div>

    <main>
        <section class="indicadoresMensais">
            <div class="tituloSection">

                <p class="titulo" style="margin-left:39%;">Indicadores do mês</p>
                <p class="subTitulo">01/12 á 01/01</p>
            </div>
            <div class="mensaisContent">
                <div class="indicadores">
                    <div class="tituloIndicadores">
                        <div class="tituloIndicador">
                            <label>Total Levantado</label>
                        </div>
                        <div class="tituloIndicador">
                            <label>Dias que treinou</label>
                        </div>
                        <div class="tituloIndicador">
                            <label>Series</label>
                        </div>

                    </div>
                    <div class="indicadoresContent">
                        <div class="indicador">
                            <div id="carga"></div>
                        </div>
                        <div class="indicador">
                            <div id="treinosMes"></div>
                        </div>
                        <div class="indicador">
                            <div id="seriesRealizadas"></div>
                        </div>
                    </div>
                    <div class="conquistasMensais">
                        <div class="conquistasContent">


                            <div class="grafico2">
                                <canvas id="myChart"></canvas>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </section>
        <section class="indicadoresSemanais">
            <div class="tituloSection">
                <p class="titulo">Indicadores da Semana</p>
            </div>

            <div class="semanaisContent">
                <div class="indicadorSemanal1">
                    <p>Frequencia</p>
                    <div class="indicadorSemanal indicador">
                        <div id="treinosSemana"></div>
                    </div>
                </div>

                <div class="indicadorSemanal1">

                    <p>Comparação de peso total Levantado</p>
                    <div class="indicadorSemanal indicador">
                        <div id="evolucao"></div>
                    </div>
                </div>


            </div>

        </section>

    </main>


</body>

</html>

<script>
    let idFicha = sessionStorage.ID_FICHA;
    let labels = [];
    let data = [];

    let musculoMaisTreinado

    let cargaMensal = 0
    let seriesMensais = 0
    let treinos = 0;
    let semanaAtual = 0
    let semanaPassada = 0
    let porcEvolucao = 0;

    let musculoMaisUsado = ''

let titulo;



    console.log(data)
    console.log(labels)


    let musculo = ''




    let idUsuario = sessionStorage.ID_USUARIO;

    function cargaLevantada(idFicha) {
        fetch(`/dashboard/buscar/carga/${idFicha}`)
            .then(resposta => resposta.json())
            .then(ficha => {
                console.log(ficha);
                cargaMensal = ficha[0].pesoLevantado;

                document.getElementById('carga').innerHTML = `${cargaMensal} Kg`;
            })
    }

    function fichaAtiva(idUsuario) {
        fetch(`/dashboard/buscar/fichaAtiva/${idUsuario}`)
            .then(resposta => resposta.json())
            .then(fichaAtiva => {
                console.log('aaaaaa', fichaAtiva);
                sessionStorage.ID_FICHA = fichaAtiva[0].idFicha;
                titulo = fichaAtiva[0].titulo;

        const  tituloFicha = document.getElementById('tituloFicha');

        tituloFicha.innerHTML = `<p class="titulo">Ficha: ${titulo} </p>`;


            })
    }


    function seriesMes(idFicha) {
        fetch(`/dashboard/buscar/series/mes/${idFicha}`)
            .then(resposta => resposta.json())
            .then(seriesMes => {
                console.log(seriesMes);
                seriesMensais = seriesMes[0].serieRealizada;
                console.log(seriesMensais)

                document.getElementById('seriesRealizadas').innerHTML = `${seriesMensais}`;

            })
    }



    function frequenciaMes(idFicha) {
        fetch(`/dashboard/buscar/frequencia/mes/${idFicha}`)
            .then(resposta => resposta.json())
            .then(treinosMes => {
                console.log('MENSAL', treinosMes);
                treinos = treinosMes[0].treinosDia;
                console.log(treinos)

                document.getElementById('treinosMes').innerHTML = `${treinos}`;

            })
    }



    function frequenciaSemana(idFicha) {
        fetch(`/dashboard/buscar/frequencia/semana/${idFicha}`)
            .then(resposta => resposta.json())
            .then(treinosSemana => {
                console.log('semana', treinosSemana);
                treinosSemanais = treinosSemana[0].treinosDia;
                frequencia = treinosSemana[0].frequencia;


                document.getElementById('treinosSemana').innerHTML = `${treinosSemanais}`;



            })
    }


    function variacaoCarga(idFicha) {
        fetch(`/dashboard/buscar/variacao/semana/${idFicha}`)
            .then(resposta => resposta.json())
            .then(variacaoCarga => {
                let aumento = 0

                console.log(variacaoCarga);
                semanaAtual = variacaoCarga[1].cargaSemanal;
                semanaPassada = variacaoCarga[0].cargaSemanal;

                if (semanaPassada > semanaAtual) {
                    porcEvolucao = (semanaAtual / semanaPassada) * 100;

                    aumento = 100 - porcEvolucao;

                    document.getElementById('evolucao').style.color = '#FF0000'
                    document.getElementById('evolucao').innerHTML = `${aumento.toFixed(2)}%`;


                } else {

                    porcEvolucao = (semanaPassada / semanaAtual) * 100;

                    aumento = 100 - porcEvolucao;
                    document.getElementById('evolucao').style.color = '#00FF00'

                    document.getElementById('evolucao').innerHTML = `${aumento.toFixed(2)}%`;

                }

                console.log(aumento.toFixed(2))

                console.log('SEMANA ATUAL', semanaAtual, 'SEMANA PASSADA: ', semanaPassada)
            })
    }
    function chartData(idFicha) {

        fetch(`/dashboard/buscar/seriesGrupo/mes/${idFicha}`)
            .then(resposta => resposta.json())
            .then(seriesPorGrupo => {
                console.log(seriesPorGrupo);


                seriesPorGrupo.forEach(d => {


                    data.push(d.totalSeries);
                    labels.push(d.musculo)





                });


                for (var i = 0; i < resposta.length; i++) {
                    var series = resposta[i]
                }
            }).catch(err => {
                console.log('Não sou o maioral', err)
            })

    }


    const ctx = document.getElementById('myChart');

    new Chart(ctx, {
        type: 'bar',
        data: {

            labels: labels,
            datasets: [{
                label: 'Series Realizadas no mês',
                data: data,
                borderWidth: 1,
                borderColor: '#DC0000',
                backgroundColor: '#DC0000',
                weight: 'bold'
            }],
        },
        options: {
            plugins: {
                title: {
                    display: true,
                    text: 'Series realizadas por agrupamento muscular',
                    position: 'top',
                    align: 'start',
                    color: '#fff',
                    font: {
                        weight: 'bold',
                        size: 20,


                    },
                },

            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Agrupamentos Musculares',
                        color: '#DEDED1',
                        font: {
                            size: 15,
                            weight: 'bold',
                        },
                    },
                },

                y: {
                    min: 0,
                    max: 80,


                    title: {
                        display: true,
                        text: 'Quantidade de series',
                        color: '#DEDED1',
                        font: {
                            weight: 'bold',
                            size: 15
                        },
                    },


                },
            }
        }
    });


</script>