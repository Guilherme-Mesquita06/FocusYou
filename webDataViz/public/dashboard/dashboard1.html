<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="../css/dashboard.css" />
    <link rel="stylesheet" href="../css/nav.css" />
    <title>FocusYou Dashboard</title>
</head>

<body onload="fichaAtiva(idUsuario), 
              cargaLevantada(idFicha), 
              seriesMes(idFicha),
              frequenciaMes(idFicha),
              frequenciaSemana(idFicha),
              variacaoCarga(idFicha),
              chartData(idFicha)">
    <div class="header">
        <div class="container">
            <div class="logoTitulo">
                <img src="../assets/icon/LogoFocus.svg" width="90vw" alt="" />
            </div>

            <nav class="navbar">
                <div class="links">
                    <div>
                        <a href="">Inicial</a>
                    </div>
                    <div>
                        <a href="./addTreino.html">Ficha</a>
                    </div>
                    <div>
                        <a href="./dashboard1.html">Dashboard</a>
                    </div>
                    <div>
                        <a href="./historicoFicha.html">Historico</a>
                    </div>
                </div>
            </nav>
        </div>
    </div>
    <main>


        <section class="indicadoresMensais">
            <div class="tituloSection">
                <p class="titulo">Indicadores Mensais</p>
            </div>
            <div class="mensaisContent">
                <div class="indicadores">
                    <div class="tituloIndicadores">
                        <div class="tituloIndicador">
                            <label>Peso Total</label>
                        </div>
                        <div class="tituloIndicador">
                            <label>Dias que treinou</label>
                        </div>
                        <div class="tituloIndicador">
                            <label>Series</label>
                        </div>

                    </div>
                    <div class="indicadoresContent">
                        <div class="indicador">
                            <div id="carga"></div>
                        </div>
                        <div class="indicador">
                            <div id="treinosMes"></div>
                        </div>
                        <div class="indicador">
                            <div id="seriesRealizadas"></div>
                        </div>
                    </div>
                    <div class="conquistasMensais">
                        <div class="conquistasContent">


                            <div class="grafico2">
                                <canvas id="myChart"></canvas>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </section>
        <section class="indicadoresSemanais">
            <div class="tituloSection">
                <p class="titulo">Indicadores Semanais</p>
            </div>

            <div class="semanaisContent">
                <div class="indicadorSemanal indicador">
                    <div id="treinosSemana"></div>
                </div>
                <div class="indicadorSemanal indicador">
                    <div id="evolucao"></div>
                </div>
                <div class="indicadorSemanal indicador"></div>


            </div>

        </section>

    </main>


</body>

</html>

<script>
    let labels = [];
    let data = [];

    let musculoMaisTreinado

    let cargaMensal = 0
    let idFicha = sessionStorage.ID_FICHA;
    let seriesMensais = 0
    let treinos = 0;
    let semanaAtual = 0
    let semanaPassada = 0
    let porcEvolucao = 0;

    let musculoMaisUsado= ''

    

 

    console.log(data)
    console.log(labels)

    const ctx = document.getElementById('myChart');

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: '# of Votes',
                data: data,
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });


    let musculo = ''




    let idUsuario = sessionStorage.ID_USUARIO;

    function cargaLevantada(idFicha) {
        fetch(`/dashboard/buscar/carga/${idFicha}`)
            .then(resposta => resposta.json())
            .then(ficha => {
                console.log(ficha);
                cargaMensal = ficha[0].pesoLevantado;

                document.getElementById('carga').innerHTML = `${cargaMensal} Kg`;
            })
    }

    function fichaAtiva(idUsuario) {
        fetch(`/dashboard/buscar/fichaAtiva/${idUsuario}`)
            .then(resposta => resposta.json())
            .then(fichaAtiva => {
                console.log(fichaAtiva);
                sessionStorage.ID_FICHA = fichaAtiva[0].idFicha;


            })
    }


    function seriesMes(idFicha) {
        fetch(`/dashboard/buscar/series/mes/${idFicha}`)
            .then(resposta => resposta.json())
            .then(seriesMes => {
                console.log(seriesMes);
                seriesMensais = seriesMes[0].serieRealizada;
                console.log(seriesMensais)

                document.getElementById('seriesRealizadas').innerHTML = `${seriesMensais}`;

            })
    }



    function frequenciaMes(idFicha) {
        fetch(`/dashboard/buscar/frequencia/mes/${idFicha}`)
            .then(resposta => resposta.json())
            .then(treinosMes => {
                console.log('MENSAL', treinosMes);
                treinos = treinosMes[0].treinosDia;
                console.log(treinos)

                document.getElementById('treinosMes').innerHTML = `${treinos}`;

            })
    }



    function frequenciaSemana(idFicha) {
        fetch(`/dashboard/buscar/frequencia/semana/${idFicha}`)
            .then(resposta => resposta.json())
            .then(treinosSemana => {
                console.log('semana', treinosSemana);
                treinosSemanais = treinosSemana[0].treinosDia;
                frequencia = treinosSemana[0].frequencia;


                document.getElementById('treinosSemana').innerHTML = `${treinosSemanais}`;



            })
    }


    function variacaoCarga(idFicha) {
        fetch(`/dashboard/buscar/variacao/semana/${idFicha}`)
            .then(resposta => resposta.json())
            .then(variacaoCarga => {
                let aumento = 0

                console.log(variacaoCarga);
                semanaAtual = variacaoCarga[1].cargaSemanal;
                semanaPassada = variacaoCarga[0].cargaSemanal;

                if (semanaPassada > semanaAtual) {
                    porcEvolucao = (semanaAtual / semanaPassada) * 100;

                    aumento = 100 - porcEvolucao;

                    document.getElementById('evolucao').style.color = '#FF0000'
                    document.getElementById('evolucao').innerHTML = `${aumento.toFixed(2)}%`;


                } else {

                    porcEvolucao = (semanaPassada / semanaAtual) * 100;

                    aumento = 100 - porcEvolucao;
                    document.getElementById('evolucao').style.color = '#00FF00'

                    document.getElementById('evolucao').innerHTML = `${aumento.toFixed(2)}%`;

                }

                console.log(aumento.toFixed(2))

                console.log('SEMANA ATUAL', semanaAtual, 'SEMANA PASSADA: ', semanaPassada)
            })
    }
    function chartData(idFicha) {

        fetch(`/dashboard/buscar/seriesGrupo/mes/${idFicha}`)
            .then(resposta => resposta.json())
            .then(seriesPorGrupo => {
                console.log(seriesPorGrupo);
                

                seriesPorGrupo.forEach(d => {


                    data.push(d.totalSeries);
                    labels.push(d.musculo)

                    

            

                });


                for(var i = 0 ; i < resposta.length; i++){
                    var series = resposta[i]
                }
            }).catch(err => {
                console.log('NÃ£o sou o maioral', err)
            })

    }
</script>