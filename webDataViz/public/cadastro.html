<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./css/cadastro.css">
  <link rel="stylesheet" href="./css/nav.css">
  <title>Aretê</title>
</head>

<body>


  <div class="header">
    <div class="container">
      <div class="logoTitulo">
        <img src="./assets/icon/LogoFocus.svg" width="90vw" alt="">
        <p class="navTitulo">Aretê</p>

      </div>

      <nav class="navbar">
        <div class="links">

          <div>
            <a href="./login1.html">Login</a>
          </div>
          <div style="background-color: brown;">
            <a href="#">Cadastro</a>
          </div>
        </div>
      </nav>

    </div>
  </div>
  <main>



    <section class="cadastroSection">
      <div class="cadastro">
        <div class="imgFocus">
          <img src="./assets/fundoCad.png" alt="">
        </div>
        <div class="campos">
          <div class="titulo">
            <p>Cadastro</p>
          </div>
          <div class="formCad">
            <form>
              <label for="iptNome">Nome </label>
              <input id="iptNome" type="text" placeholder="">

              <label for="iptEmail">Email</label>
              <input id="iptEmail" type="text" placeholder="usuariouser@provedor.com">
              <div id="emailBom"></div>

              <label>Senha</label>
              <input oninput="Verificar()" id="iptSenha" type="password" placeholder="******">
              <idv id="senhaForte"></idv>

              <label>Peso atual</label>
              <input id="iptPeso" type="number" placeholder="89.5">

              <label>Quando começou a treinar? (Ou iniciará)</label>
              <input id="iptDataTreino" type="date">
            </form>

          </div>
          <div class="btn">
            <button onclick="cadastrar()">Cadastrar</button>
          </div>
          <div id="mensagem_erro"></div>


        </div>

      </div>

    </section>

  </main>

</body>

<script>


  let emailsCadastrados = []

  function cadastrar() {
    // aguardar();

    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo
    var nomeVar = iptNome.value;
    var emailVar = iptEmail.value;
    var senhaVar = iptSenha.value;
    var pesoVar = Number(iptPeso.value);
    var dataTreinoVar = iptDataTreino.value;

    // Verificando se há algum campo em branco
    if (
      nomeVar == "" ||
      emailVar == "" ||
      senhaVar == "" ||
      pesoVar == "" ||
      dataTreinoVar == ""
    ) {
      mensagem_erro.innerHTML =
        '<p style="color:#fc0500; font-weight: bold;">Todos os campos precisam estar preenchidos</p>'
    } else if (pesoVar < 0) {
      mensagem_erro.innerHTML =
        '<p style="color:#fc0500; font-weight: bold;">Peso não pode ser negativo!</p>'

    } else {



      // Enviando o valor da nova input
      fetch("/usuarios/cadastrar", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          // crie um atributo que recebe o valor recuperado aqui
          // Agora vá para o arquivo routes/usuario.js
          nomeServer: nomeVar,
          emailServer: emailVar,
          senhaServer: senhaVar,
          pesoServer: pesoVar,
          dataTreinoServer: dataTreinoVar,
        }),
      })
        .then(function (resposta) {
          console.log("resposta: ", resposta);

          if (resposta.ok) {

            mensagem_erro.innerHTML = `<p style="color:#70F000; font-weight: bold;">Cadastro realizado com sucesso! Redirecionando para tela de Login...</p>`;

            setTimeout(() => {
              window.location = "login1.html";
            }, "2000");

            limparFormulario();
            // finalizarAguardar();
          } else {
            throw "Houve um erro ao tentar realizar o cadastro!";
          }
        })
        .catch(function (resposta) {
          console.log(`#ERRO: ${resposta}`);

          // finalizarAguardar();
        });

      return false;
    }
  }





  function Verificar() {
    var i = 0;
    var senha = iptSenha.value;


    var criterio1 = 0
    var criterio2 = 0
    var criterio3 = 0
    var criterio4 = 0


    var maiusculo = 'ABCDEFGHIJKLMNPQRSTUVWXYZ'
    var minusculo = 'abcdefghijklmnpqrstuvwxyz'
    var especiais = '!@#$%*()[]ªº¹²³£¢¬<>,.;:/?°-=+_§|'
    var numeros = '123456789'


    var caracter = '';





    console.log(senha)


    if (senha.length < 8) {
      senhaForte.innerHTML = '<p style="color:#fc0500; font-weight: bold;">Senha deve conter ao menos 8 caracteres</p>'

    } else {
      while (i < senha.length) {
        caracter = senha[i];


        if (maiusculo.includes(caracter)) {
          criterio1 = 1;

        } else if (minusculo.includes(caracter)) {
          criterio2 = 1;
        } else if (especiais.includes(caracter)) {
          criterio3 = 1;
        } else if (numeros.includes(caracter)) {
          criterio4 = 1;
        }



        i++;

      }
      var criterios = criterio1 + criterio2 + criterio3 + criterio4

      if (criterios == 4) {
        senhaForte.innerHTML = '<p style="color:#006400; font-weight: bold; ">Senha muito Forte</p>'
      } else if (criterios == 3) {

        senhaForte.innerHTML = '<p style="color:#70F000; font-weight: bold;">Senha forte</p>'
      } else if (criterios == 2) {
        senhaForte.innerHTML = '<p style="color:#cFF000; font-weight: bold;">Senha fraca</p>'

      } else {
        senhaForte.innerHTML = '<p style="color:#fc0500; font-weight: bold;">Senha fraca</p>'


      }
    }
  }




</script>

</html>